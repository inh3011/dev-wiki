# IAM

## IAM?

- IAM은 Identity and Access Management의 약자이고, 사용자를 생성하고 그룹에 배치하기 때문에 글로벌 서비스이다.
- Root 계정을 생성하게 되면 기본으로 생성된다. 루트 계정은 계정을 생성할 때만 사용하고 그 후에는 유저를 생성해서 사용해야 한다.
- 사용자를 생성할 때, 사용자는 조직 내에 한 사람으로 해당 된다. 사용자들끼리 그룹을 묶을 수 있다.
  
## IAM: Users & Groups

### Groups
- 6명의 사용자가 있다고 가정하자.
  - (A, B, C) 그룹
  - (C, D)그룹
  - (D, E) 그룹 
- 그룹에는 사용자만 포함 가능하고 그룹을 포함할 수 없다.
- 사용자는 그룹에 포함하지 않을 수 있는데, 권장하지 않는다.
- 사용자는 여러 그룹에 속할 수 있다.
  
### Why use Groups?
  - AWS 계정을 사용하도록 하기 위해서이다.
  - 허용을 위해서 권한을 부여해야 한다.


## IAM: Permissions?

- 사용자 또는 그룹에는 정책, IAM 정책이라고 불리는 JSON 문서를 할당할 수 있다.
- 이러한 정책은 사용자의 권한을 정의한다.  
- AWS에서는 최소 권한 원칙(Least Privilege Principle)을 적용해서, 사용자에게 필요한 권한 이상을 부여하지 않는다.
  - 사용자가 꼭 필요로 하는 것 이상의 권한을 주지 않는다.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "ec2:Describe*",
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action": "elasticloadbalancing:Describe*",
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action": [
        "cloudwatch:ListMetrics",
        "cloudwatch:GetMetricStatistics",
        "cloudwatch:Describe*"
      ],
      "Resource": "*"
    }
  ]
}
```
## IAM: Create Users

### 1. IAM 콘솔 접속
- AWS 콘솔에 로그인 후 검색창에 IAM을 입력하여 IAM 콘솔로 이동한다.
- IAM은 글로벌 서비스이므로 리전 선택이 필요하지 않다.

### 2. 사용자 메뉴 선택
- 왼쪽 메뉴에서 Users를 클릭한다.

### 3. 새 사용자 생성
- Create users 버튼을 클릭한다.
- 사용자 이름을 입력한다.
- AWS Management Console access를 선택하여 콘솔 접근 권한을 부여할지 결정한다.
  - 콘솔 접근 권한 선택 시, Console Password는 Autogenerated 또는 Custom 옵션 중 하나를 선택할 수 있다.

### 4. 사용자 권한 부여
- Set permissions 단계에서 아래 옵션 중 하나를 선택한다:
  - Add user to group: 기존 그룹에 사용자를 추가하거나 새 그룹을 생성하여 권한을 할당한다.
  - Copy permissions from existing user: 기존 사용자의 권한을 복사한다.
  - Attach policies directly: 필요한 정책을 직접 사용자에 연결한다.

### 5. 검토 및 생성
- 모든 설정 내용을 확인한 후 Create user 버튼을 클릭하여 사용자 생성을 완료한다.

## IAM: Policies Structure

### 주요 구성 요소
1. Version (버전) – 정책 언어 버전 (항상 “2012-10-17” 포함) 이다.  
2. Id (아이디) – 정책을 식별하는 선택적 요소이다.  
3. Statement (문) – 하나 이상의 개별적인 문(필수)이다.  

### Statement(문)의 구성 요소
1. Sid (식별자, Sid) – 문(statement)의 식별자 (선택 사항)이다.  
2. Effect (효과) – 해당 문이 허용(Allow) 또는 거부(Deny) 하는지 여부를 지정한다.  
3. Principal (주체) – 정책이 적용되는 계정, 사용자 또는 역할을 정의한다.  
4. Action (작업) – 정책에서 허용하거나 거부하는 작업 목록을 정의한다.  
5. Resource (리소스) – 작업이 적용되는 리소스 목록을 지정한다.  
6. Condition (조건) – (선택 사항) 정책이 적용되는 조건을 정의한다.  

- Root 유저는 자유롭게 원하는 그룹을 생성할 수 있고 그룹을 부여할 수 있으며 또한 정책을 생성하고 부여할 수 도 있다. 

## IAM: Password Policy

사용자와 그룹이 손상되지 않도록 보호해야 한다. 두 가지 방어 매커니즘이 있다.

### 비밀번호 정책(Password Policy)  
- 다양한 옵션으로 비밀번호 정책을 설정할 수 있다.
    - 대문자 (Uppercase letters)
    - 소문자 (Lowercase letters)
    - 숫자 (Numbers)
    - 특수 문자 (Non-alphanumeric characters)

### Multi Factor Authentication - MFA
- 다중 인증 또는 MFA
  - 다양한 설정과 리소스를 변경하고 삭제하기 때문에 AWS 에서는 필수로 사용해야 한다.
  - 비밀번호와 소유한 보안 장치의 조합을 사용한다.
  - MFA의 이점은?
    - 비밀번호를 도난당하거나 해킹당했을 때, 물리적인 장치도 확보해야 하므로 계정이 손상되지 않는다.

### MFA devices options in AWS
**Virtual MFA device**  
하나의 디바이스에서 여러개의 사용자와 계정을 보유할 수 있어 많이 사용한다.  
- Google Authenticator
- Authy

**Universal 2nd Factor (U2F) Security Key**  
물리적인 키이고 단일 보안 키를 사용한다.

**Hardware Key Fob MFA Device**  
**Hardware Key Fob MFA Device for AWS GovCloud (US)**

## How can users access AWS?
- AWS 에 접근하는 방법은 세 가지가 있습니다.
  - AWS Management Console (비밀번호 + MFA로 보호됨)
  - AWS 명령줄 인터페이스(CLI)
  - AWS 소프트웨어 개발 키트(SDK)
- 액세스 키는 AWS 콘솔에서 생성된다
- 사용자는 자신의 액세스 키를 직접 관리한다.
- 액세스 키는 비밀번호처럼 비밀로 취급되어야 하며, 공유하지 말아야 한다
- Access Key ID는 일종의 사용자 이름과 비슷하다.
- Secret Access Key는 비밀번호와 비슷하다. 

### What’s the AWS CLI?
- 상호작용할 수 있게 허용된 도구이다. AWS 서비스를 CLI에서 조작할 수 있게
- AWS 서비스의 공개 API에 직접 접근이 가능하다
- 리소스를 관리하는 스크립트를 작성할 수 있다.
- 웹 대안으로 사용 가능하다.

### What's the AWS SDK?
- AWS 소프트웨어 개발 키트
- 라이브러리를 제공한다.
- AWS 서비스를 코드로 접근하고 관리할 수 있다.
- 애플리케이션 내부에 직접 포함되어 사용한다.


### Install AWS CLI (MAC)

1. 설치 패키지 다운로드 
  ```shell
  curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"
  ```

2. 다운받은 패키지 설치 
  ```shell
  sudo installer -pkg AWSCLIV2.pkg -target /
  ```

3. 설치 확인
  ```shell
  which aws
  aws --version
  ```
  
[공식 AWS CLI 설치 가이드](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)
